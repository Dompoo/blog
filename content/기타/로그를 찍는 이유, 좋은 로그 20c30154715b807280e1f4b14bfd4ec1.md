# 로그를 찍는 이유, 좋은 로그

작성일: 2025년 6월 8일 오후 10:54
카테고리: Log

- 문제 해결 (디버깅)
    - 어떠한 문제가 발생하였을 때, 그 원인을 빠르게 추적하고 해결하도록 한다.
    - `[ERROR][OrderService] Failed to process order. userId=1234, productId=5678, stage=payment, reason=Timeout`
- 시스템 모니터링
    - 응답 시간, 트래픽 등을 모니터링할 수 있도록 한다.
    - `[INFO][APIRequest] responseTime=742`
- 보안 및 감시
    - 수상한 요청이나 로직을 감시하고, 존재한다면 빠르게 조치할 수 있도록 한다.
    - `[WARN][LoginFailed] ip=127.1.3.15, attemptCount=12`
- 비즈니스 분석
    - 사용자의 행동 패턴을 분석하여 서비스를 개선할 수 있도록 한다.
    - `[INFO][ButtonClick] buttonId=AddToCart`
- 위 이유들 중에서 **내가 가장 관심있는 로그는 문제 해결을 위한 로그이다.**
- 어떤 로그를 찍어야 문제 해결을 잘 할 수 있을까?

### 목표가 명확해야 한다.

- 먼저 목표를 정의해야 한다.
    - 토스 결제 승인 API의 어떤 부분에서 문제가 발생했는지 파악하고, 고객의 이탈을 방지한다.
- 그 후에 목표를 달성하기 위한 로그 내용을 고려한다.
    - 어떤 고객의 이탈을 방지하고 싶은지 남긴다.
    - 어떤 부분에서 문제가 발생했는지 남긴다.
    - 해당 고객이 토스 결제 승인 API를 몇번 시도했는지 남긴다.

### 의미가 명확해야 한다.

- 어디서 발생한 로그인지 명확해야 한다.
    - PaymentService 클래스 → ApprovePayment 기능 → ApproveTossPayment 부분
- 누가 발생시킨 로그인지 명확해야 한다.
    - userId, sessionId 등을 같이 기재한다.
- 해당 상태를 파악할 수 있어야 한다.
    - 핵심 필드(productId, amount등)을 같이 기재한다.

### 데이터를 얻기 쉬워야 한다.

- 구조적으로 정형화되면 좋다. (JSON등)
    - timestamp 등의 메타데이터와 함께 더 필요한 key가 있다면 협의하여 정한다.

### 최종 예시

- fields
    - timestamp
    - level
    - location
    - event
    - stage
    - error
    - errorMessage

```java
{
  "timestamp": "2025-06-08T14:30:15.123Z",
  "level": "ERROR",
  "location": "com.example.order.OrderService",
  "event": "OrderProcessingFailed",
  "stage": "Payment",
  "error": "TimeoutException",
  "errorMessage": "Payment gateway timeout after 30s"
  // 필요한 필드를 추가 기재
}
```