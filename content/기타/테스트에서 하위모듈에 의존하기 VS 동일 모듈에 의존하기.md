# 테스트에서 하위모듈에 의존하기 VS 동일 모듈에 의존하기

작성일: 2025년 6월 7일 오후 4:22
카테고리: Test

- 예를 들어 `MemberService.findMember()` 를 테스트 할 때, `MemberService.addMember()` 를 통해 더미데이터를 넣을지, `MemberRepository.addMember()` 를 통해 더미데이터를 넣을지에 대한 이야기다.
- 하위 모듈(MemberRepository 등)에 의존한다면
    - **다른 모듈은 이미 검증이 완료**되었다고 이해된다.
    - 따라서 한 테스트코드 안에서 실패할 수 있는 것은 오직 테스트하려는 기능 하나 뿐이다.
    - 테스트가 실패하는 원인이 명확해지고 디버깅이 쉽다.
    - 하지만 실제 동작과는 다르다. 실제로는 동일 모듈을 계속 호출하게 될 것이기 때문이다.
- 동일 모듈(MemberService)에 의존한다면
    - 다른 기능에 의존하게 된다.
    - 따라서 `MemberSevice.addMember()` 가 실패한다면, `MemberService.findMember()` 역시 실패하게 된다. → 실제 동작과 비슷하다. 실제로도 하나가 실패하면 다른 것도 실패한다.
    - 하지만 테스트코드의 실패 이유가 명확하지 않다.
- 나의 생각
    - 선택은 테스트의 목적에 따라 다를 것 같다. 나의 경우 `MemberService` 를 테스트하는 이유는 아마도 다른 하위 모듈을 제대로 호출하는지 그 연결성을 테스트하는 것이다.
    - 따라서 동일 모듈을 사용하는 것은 현실과 비슷하지만, 테스트의 목적에는 어긋난다. → 하위 모듈에 의존하도록 설계한다.
    - 하지만 하위 모듈에 의존하는 것 역시 테스트의 목적성에 온전히 일치하지는 않는 것이, 테스트를 위한 셋업 과정에서 이미 하위 모듈과의 상호작용이 발생한다면, 검증부에서의 상호작용만을 온전히 테스트하기 어렵기 때문이다.
    - 이 부분에 있어서 나는 `TestUtil`을 사용해볼 것 같다.
        
        ![[테스트에서 하위모듈에 의존하기 VS 동일 모듈에 의존하기_image.png]]
        
    - 솔직히 코드만 보면 하위 모듈에 의존하게 된다. (DataCleaner 등이 Repository 레벨에 의존한다.)
    - 하지만 테스트 코드 수준에서는 아주 깔끔해진다.
        
        ![[테스트에서 하위모듈에 의존하기 VS 동일 모듈에 의존하기_image 1.png]]
        
        ![[테스트에서 하위모듈에 의존하기 VS 동일 모듈에 의존하기_image 2.png]]
        
    - 테스트 코드 또한 캡슐화하는 것이다. 개발자가 신경쓰지 않아도 되는 내부 구현은 최대한 숨기고, 필요한 동작만을 드러낸다.
    - 이 테스트를 읽는 개발자는 ‘어떻게든 뭐 데이터가 삽입되고, 이 데이터를 조회하는 메서드를 호출하는 군.’ 정도로 생각할 수 있어서 가독성을 향상 시키며, 정말 중요한 부분에 집중하도록 만든다.