## 서블릿 (Server + applet)

- 서버에서 실행되는 작은 프로그램이라는 뜻이다.
- 클라이언트의 요청을 처리하고 응답을 반환하는 자바 클래스이다.
    - `HttpServletRequest` , `HttpServletResponse` 객체를 사용
- 자바 코드 중심이다. (자바가 응답/HTML을 들고 있는다.)
- 자바를 통해 동적 컨텐츠를 생성할 수 있다.
- `GenericServlet`, `HttpServlet` 등이 대표적이다.
- 생명주기
    - 서블릿 로딩
    - 서블릿 인스턴스 생성
    - `init()` : 초기화
    - 실제 동작(`doGet()`, `doPost()`, …)
    - `detroy()`  : 파괴 및 종료

## 서블릿 컨테이너

- 서블릿을 관리하고 실행하는 프로그램이다.
- 웹 서버와 웹 애플리케이션 사이 인터페이스 역할을 수행한다.
- 서블릿 생명주기를 관리한다. (서블릿의 `init()` 시점을 결정하는 등)
- 클라이언트의 요청을 `HttpServletRequest/Response` 객체로 변환하여 적절한 서블릿에게 보낸다.

## 서블릿 컨테이너 vs WAS

- [[WAS vs WS|WAS]]가 좀 더 큰 개념이다.
    - 서블릿 컨테이너는 서블릿을 실행시키는 환경이다.
    - WAS는 서블릿 컨테이너 + 웹서버(정적 콘텐츠 제공) 이다.
- [[톰캣 구조|Tomcat]]의 경우 서블릿 컨테이너이며, WAS의 일부 기능을 지원하기 때문에 경량 WAS 이기도 하다.
    - 정적 콘텐츠는 제공할 수 있다.
    - JEE의 모든 기능을 지원하지는 않는다.

## 전체 프로세스

1. 클라이언트가 HTTP 요청을 보낸다.
2. Tomcat이 HTTP 요청을 받는다. (Tomcat Connector)
    - 정적인 컨텐츠는 Tomcat 내장 웹서버가 바로 처리한다.
    - 동적인 컨텐츠는 서블릿 컨테이너로 전달한다.
3. 서블릿 컨테이너가 HTTP 요청을 받는다.
4. HTTP 요청을 토대로 `HttpServletRequest/Response` 객체를 생성한다.
5. 요청 처리용 워커 스레드를 할당하고, 요청을 처리할 적절한 서블릿을 찾는다.
(스프링 Web MVC에서는 `DispatcherServlet`이 이에 해당한다.)
6. `DispatcherServlet` 이 `HttpServletRequest/Response` 객체를 받는다.
7. `HandlerMapping` 를 통해 핸들러를 찾는다.
8. `HandlerAdapter` 를 통해 핸들러를 실행한다. ([[Controller VS Servlet|Controller]])
    - 핸들러의 응답이 ModelView라면 [[ViewResolver VS HttpMessageConverter|ViewResolver]] 를 통해 뷰를 만든다.
    - 핸들러의 응답이 응답객체라면 [[ViewResolver VS HttpMessageConverter|MessageConverter]] 를 통해 응답 메시지를 만든다.

## 커넥터 vs 스레드

- HTTP 요청 → 커넥터 → 스레드 순으로 연결된다.
- 커넥터는 HTTP 요청 수신에 핵심이 있다.
    - TCP 연결 수립
    - Request / Response 객체 생성
- 스레드는 실제 로직 실행에 핵심이 있다.
    - [[톰캣과 스레드풀|스레드풀]]은 [[프로세스, 스레드, 자바 가상스레드|스레드]] 개수를 제한한다.
    - 스레드풀은 스레드를 미리 생성하여 매치시켜준다.
- 커넥터 기본 개수는 10000개, 스레드 기본 개수는 200개이다.
    - 250개 요청이 들어오면 50명은 처리가 느려진다. (앞 사람이 끝나길 기다림)
    - 10050개 요청이 들어오면 50명은 요청이 거부된다. (연결 수립도 안됨)