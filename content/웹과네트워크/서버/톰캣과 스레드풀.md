스프링부트에서 `application.yml` 설정을 수정하여 스레드풀 상세 설정을 할 수 있다.

## Http Connector 설정

```bash
server:
  tomcat:
    accept-count: 1
    max-connections: 1
    threads:
      min-spare: 2
      max: 2
```

- `max-connections` : 톰캣이 관리하는 작업 큐에 쌓아둘 수 있는 작업의 양이다. 이 양보다 더 많은 요청이 들어오면, 나머지 것들은 OS 레벨의 작업 큐에 들어간다.
- `accept-count` : OS 레벨의 작업 큐 크기이다. 이보다 더 많은 경우 connection refused 응답이 반환되기 시작한다.
- `min-spare` : 최소 스레드 개수이다. 아무리 요청이 없어도 이만큼의 스레드는 유지된다.
- `max` : 최대 스레드 개수이다. 요청이 많이 오는 경우 이만큼까지 스레드 개수가 증가할 수 있다. (최대 동시 처리 개수)

## 스레드풀 동작 방식

- 소켓 연결이 수립되면 해당 소켓을 스레드에게 할당한다.
- 부하가 들어와서 스레드 10개가 모두 소진되면 작업큐에 넣어둔다.
- 작업큐의 최대 개수까지 사용하면 스레드를 max 개수까지 스레드를 늘리면서 작업을 수행한다.
- 스레드 개수도 max가 되면 connection refused 응답을 반환하기 시작한다.

## BIO Connector / NIO Connector

위 과정에서 손해보는 부분이 있는데, ‘소켓 연결이 수립되면 할당한다’ 부분이다. 소켓 연결이 수립되어도 실제 요청이 오는데까지 시간이 걸릴 수 있기 때문이다. 따라서 톰캣은 이 부분을 NIO Connector를 통해 해결한다.

- 개념적으로, 소켓을 넣어두는 이벤트 큐가 존재하며, 모든 요청은 이 이벤트 큐에 1차적으로 삽입된다.
- 소켓 연결이 수립되고 나서 데이터가 준비되었을 때, 이벤트 큐에서 제거되고 스레드에게 작업이 위임된다.